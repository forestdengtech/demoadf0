{
	"name": "asal400_notebook1",
	"properties": {
		"nbformat": 4,
		"nbformat_minor": 2,
		"bigDataPool": {
			"referenceName": "SparkPool01",
			"type": "BigDataPoolReference"
		},
		"sessionProperties": {
			"driverMemory": "28g",
			"driverCores": 4,
			"executorMemory": "28g",
			"executorCores": 4,
			"numExecutors": 2,
			"conf": {
				"spark.dynamicAllocation.enabled": "false",
				"spark.dynamicAllocation.minExecutors": "2",
				"spark.dynamicAllocation.maxExecutors": "2"
			}
		},
		"metadata": {
			"saveOutput": true,
			"synapse_widget": {
				"version": "0.1",
				"state": {
					"4f89bda4-da09-4776-8d3b-ada022869ef4": {
						"type": "Synapse.DataFrame",
						"sync_state": {
							"table": {
								"rows": [
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "3208",
										"3": 4,
										"4": "33.860000000000000000",
										"5": "135.440000000000000000",
										"6": "20161231",
										"7": "43.200000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "1820",
										"3": 4,
										"4": "28.650000000000000000",
										"5": "114.600000000000000000",
										"6": "20161231",
										"7": "35.680000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "3372",
										"3": 2,
										"4": "23.040000000000000000",
										"5": "46.080000000000000000",
										"6": "20161231",
										"7": "13.060000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "1373",
										"3": 3,
										"4": "34.650000000000000000",
										"5": "103.950000000000000000",
										"6": "20161231",
										"7": "31.020000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "2760",
										"3": 1,
										"4": "36.130000000000000000",
										"5": "36.130000000000000000",
										"6": "20161231",
										"7": "7.250000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "2253",
										"3": 4,
										"4": "26.800000000000000000",
										"5": "107.200000000000000000",
										"6": "20161231",
										"7": "28.000000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "3498",
										"3": 4,
										"4": "25.080000000000000000",
										"5": "100.320000000000000000",
										"6": "20161231",
										"7": "28.680000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "2358",
										"3": 3,
										"4": "23.290000000000000000",
										"5": "69.870000000000000000",
										"6": "20161231",
										"7": "24.930000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "198",
										"3": 4,
										"4": "30.820000000000000000",
										"5": "123.280000000000000000",
										"6": "20161231",
										"7": "41.800000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									},
									{
										"0": "bebd0650-b54f-43c4-bf18-f96fcc16fcf5",
										"1": "3",
										"2": "190",
										"3": 1,
										"4": "24.650000000000000000",
										"5": "24.650000000000000000",
										"6": "20161231",
										"7": "6.700000000000000000",
										"8": 6,
										"9": 35,
										"10": "7374"
									}
								],
								"schema": [
									{
										"key": "0",
										"name": "TransactionId",
										"type": "string"
									},
									{
										"key": "1",
										"name": "CustomerId",
										"type": "int"
									},
									{
										"key": "2",
										"name": "ProductId",
										"type": "smallint"
									},
									{
										"key": "3",
										"name": "Quantity",
										"type": "tinyint"
									},
									{
										"key": "4",
										"name": "Price",
										"type": "decimal"
									},
									{
										"key": "5",
										"name": "TotalAmount",
										"type": "decimal"
									},
									{
										"key": "6",
										"name": "TransactionDate",
										"type": "int"
									},
									{
										"key": "7",
										"name": "ProfitAmount",
										"type": "decimal"
									},
									{
										"key": "8",
										"name": "Hour",
										"type": "tinyint"
									},
									{
										"key": "9",
										"name": "Minute",
										"type": "tinyint"
									},
									{
										"key": "10",
										"name": "StoreId",
										"type": "smallint"
									}
								]
							},
							"isSummary": false,
							"language": "scala"
						},
						"persist_state": {
							"view": {
								"type": "details",
								"chartOptions": {
									"chartType": "bar",
									"aggregationType": "sum",
									"categoryFieldKeys": [
										"0"
									],
									"seriesFieldKeys": [
										"1"
									],
									"isStacked": false
								}
							}
						}
					},
					"e5b844fe-7f0a-4e03-b713-85f5a5affc2e": {
						"type": "Synapse.DataFrame",
						"sync_state": {
							"table": {
								"rows": [
									{
										"0": "20161231",
										"1": "3208",
										"2": "4341.600000000000000000",
										"3": "2.4364",
										"4": "402"
									},
									{
										"0": "20161231",
										"1": "1820",
										"2": "2809.800000000000000000",
										"3": "2.2993",
										"4": "315"
									},
									{
										"0": "20161231",
										"1": "3372",
										"2": "2442.220000000000000000",
										"3": "2.4605",
										"4": "374"
									},
									{
										"0": "20161231",
										"1": "1373",
										"2": "827.200000000000000000",
										"3": "2.5",
										"4": "80"
									},
									{
										"0": "20161231",
										"1": "2760",
										"2": "435.000000000000000000",
										"3": "2.7273",
										"4": "60"
									},
									{
										"0": "20161231",
										"1": "2253",
										"2": "2121.000000000000000000",
										"3": "2.3858",
										"4": "303"
									},
									{
										"0": "20161231",
										"1": "3498",
										"2": "3018.570000000000000000",
										"3": "2.4765",
										"4": "421"
									},
									{
										"0": "20161231",
										"1": "2358",
										"2": "448.740000000000000000",
										"3": "2.25",
										"4": "54"
									},
									{
										"0": "20161231",
										"1": "198",
										"2": "15560.050000000000000000",
										"3": "2.453",
										"4": "1489"
									},
									{
										"0": "20161231",
										"1": "190",
										"2": "7698.300000000000000000",
										"3": "2.559",
										"4": "1149"
									},
									{
										"0": "20161231",
										"1": "197",
										"2": "7499.400000000000000000",
										"3": "2.6174",
										"4": "1293"
									},
									{
										"0": "20161231",
										"1": "4393",
										"2": "2767.660000000000000000",
										"3": "2.6268",
										"4": "373"
									},
									{
										"0": "20161231",
										"1": "1965",
										"2": "4633.790000000000000000",
										"3": "2.4248",
										"4": "371"
									},
									{
										"0": "20161231",
										"1": "2128",
										"2": "2761.900000000000000000",
										"3": "2.3203",
										"4": "355"
									},
									{
										"0": "20161231",
										"1": "629",
										"2": "2927.520000000000000000",
										"3": "2.3108",
										"4": "342"
									},
									{
										"0": "20161231",
										"1": "1584",
										"2": "477.300000000000000000",
										"3": "2.5517",
										"4": "74"
									},
									{
										"0": "20161231",
										"1": "1155",
										"2": "475.440000000000000000",
										"3": "2.0741",
										"4": "56"
									},
									{
										"0": "20161231",
										"1": "553",
										"2": "328.160000000000000000",
										"3": "2.4348",
										"4": "56"
									},
									{
										"0": "20161231",
										"1": "266",
										"2": "2798.500000000000000000",
										"3": "2.3577",
										"4": "290"
									},
									{
										"0": "20161231",
										"1": "1039",
										"2": "2397.600000000000000000",
										"3": "2.368",
										"4": "296"
									},
									{
										"0": "20161231",
										"1": "3860",
										"2": "2401.980000000000000000",
										"3": "2.3902",
										"4": "294"
									},
									{
										"0": "20161231",
										"1": "4006",
										"2": "2498.300000000000000000",
										"3": "2.4472",
										"4": "301"
									},
									{
										"0": "20161231",
										"1": "3432",
										"2": "592.040000000000000000",
										"3": "2.6207",
										"4": "76"
									},
									{
										"0": "20161231",
										"1": "196",
										"2": "9050.360000000000000000",
										"3": "2.4758",
										"4": "1228"
									},
									{
										"0": "20161231",
										"1": "213",
										"2": "8249.640000000000000000",
										"3": "2.4341",
										"4": "1127"
									},
									{
										"0": "20161231",
										"1": "175",
										"2": "13563.250000000000000000",
										"3": "2.5264",
										"4": "1195"
									},
									{
										"0": "20161231",
										"1": "227",
										"2": "12250.630000000000000000",
										"3": "2.5032",
										"4": "1159"
									},
									{
										"0": "20161231",
										"1": "171",
										"2": "9722.700000000000000000",
										"3": "2.4894",
										"4": "1170"
									},
									{
										"0": "20161231",
										"1": "956",
										"2": "2564.620000000000000000",
										"3": "2.6467",
										"4": "397"
									},
									{
										"0": "20161231",
										"1": "2790",
										"2": "2499.100000000000000000",
										"3": "2.5573",
										"4": "335"
									},
									{
										"0": "20161231",
										"1": "2592",
										"2": "495.880000000000000000",
										"3": "2.4839",
										"4": "77"
									},
									{
										"0": "20161231",
										"1": "3158",
										"2": "2358.000000000000000000",
										"3": "2.5032",
										"4": "393"
									},
									{
										"0": "20161231",
										"1": "242",
										"2": "8198.200000000000000000",
										"3": "2.5276",
										"4": "1145"
									},
									{
										"0": "20161231",
										"1": "162",
										"2": "13232.520000000000000000",
										"3": "2.5228",
										"4": "1602"
									},
									{
										"0": "20161231",
										"1": "63",
										"2": "14384.340000000000000000",
										"3": "2.4703",
										"4": "1413"
									},
									{
										"0": "20161231",
										"1": "192",
										"2": "10799.360000000000000000",
										"3": "2.3833",
										"4": "1144"
									},
									{
										"0": "20161231",
										"1": "241",
										"2": "10075.390000000000000000",
										"3": "2.5372",
										"4": "1261"
									},
									{
										"0": "20161231",
										"1": "1497",
										"2": "2825.320000000000000000",
										"3": "2.5152",
										"4": "332"
									},
									{
										"0": "20161231",
										"1": "3804",
										"2": "2935.620000000000000000",
										"3": "2.6288",
										"4": "347"
									},
									{
										"0": "20161231",
										"1": "3145",
										"2": "2909.040000000000000000",
										"3": "2.6242",
										"4": "391"
									},
									{
										"0": "20161231",
										"1": "94",
										"2": "10785.600000000000000000",
										"3": "2.5176",
										"4": "1284"
									},
									{
										"0": "20161231",
										"1": "3940",
										"2": "424.620000000000000000",
										"3": "2.2105",
										"4": "42"
									},
									{
										"0": "20161231",
										"1": "3407",
										"2": "2305.840000000000000000",
										"3": "2.5299",
										"4": "296"
									},
									{
										"0": "20161231",
										"1": "4564",
										"2": "325.440000000000000000",
										"3": "2.2857",
										"4": "48"
									},
									{
										"0": "20161231",
										"1": "157",
										"2": "8593.600000000000000000",
										"3": "2.5338",
										"4": "1310"
									},
									{
										"0": "20161231",
										"1": "812",
										"2": "2592.000000000000000000",
										"3": "2.5175",
										"4": "360"
									},
									{
										"0": "20161231",
										"1": "2994",
										"2": "3434.760000000000000000",
										"3": "2.6532",
										"4": "329"
									},
									{
										"0": "20161231",
										"1": "3606",
										"2": "2591.020000000000000000",
										"3": "2.6403",
										"4": "367"
									},
									{
										"0": "20161231",
										"1": "1399",
										"2": "669.330000000000000000",
										"3": "2.3103",
										"4": "67"
									},
									{
										"0": "20161231",
										"1": "2463",
										"2": "627.000000000000000000",
										"3": "2.5",
										"4": "75"
									},
									{
										"0": "20161231",
										"1": "107",
										"2": "8188.080000000000000000",
										"3": "2.5603",
										"4": "1252"
									},
									{
										"0": "20161231",
										"1": "2949",
										"2": "3074.500000000000000000",
										"3": "2.4432",
										"4": "430"
									},
									{
										"0": "20161231",
										"1": "4692",
										"2": "2157.400000000000000000",
										"3": "2.5556",
										"4": "322"
									},
									{
										"0": "20161231",
										"1": "4469",
										"2": "2542.320000000000000000",
										"3": "2.3955",
										"4": "321"
									},
									{
										"0": "20161231",
										"1": "2265",
										"2": "2542.000000000000000000",
										"3": "2.4118",
										"4": "328"
									},
									{
										"0": "20161231",
										"1": "1194",
										"2": "238.640000000000000000",
										"3": "2.1111",
										"4": "38"
									},
									{
										"0": "20161231",
										"1": "71",
										"2": "11474.430000000000000000",
										"3": "2.4028",
										"4": "1199"
									},
									{
										"0": "20161231",
										"1": "137",
										"2": "6336.480000000000000000",
										"3": "2.532",
										"4": "1228"
									},
									{
										"0": "20161231",
										"1": "34",
										"2": "8444.740000000000000000",
										"3": "2.5501",
										"4": "1349"
									},
									{
										"0": "20161231",
										"1": "78",
										"2": "11127.660000000000000000",
										"3": "2.3975",
										"4": "1146"
									},
									{
										"0": "20161231",
										"1": "10",
										"2": "4177.080000000000000000",
										"3": "2.4662",
										"4": "1132"
									},
									{
										"0": "20161231",
										"1": "50",
										"2": "10081.540000000000000000",
										"3": "2.4437",
										"4": "1498"
									},
									{
										"0": "20161231",
										"1": "99",
										"2": "9408.000000000000000000",
										"3": "2.5052",
										"4": "1200"
									},
									{
										"0": "20161231",
										"1": "28",
										"2": "8334.890000000000000000",
										"3": "2.5137",
										"4": "1189"
									},
									{
										"0": "20161231",
										"1": "24",
										"2": "11786.720000000000000000",
										"3": "2.5398",
										"4": "1628"
									},
									{
										"0": "20161231",
										"1": "2893",
										"2": "3918.600000000000000000",
										"3": "2.5301",
										"4": "420"
									},
									{
										"0": "20161231",
										"1": "53",
										"2": "13700.160000000000000000",
										"3": "2.5244",
										"4": "1704"
									},
									{
										"0": "20161231",
										"1": "2733",
										"2": "1653.760000000000000000",
										"3": "2.432",
										"4": "304"
									},
									{
										"0": "20161231",
										"1": "4495",
										"2": "2102.220000000000000000",
										"3": "2.25",
										"4": "306"
									},
									{
										"0": "20161231",
										"1": "1427",
										"2": "3135.630000000000000000",
										"3": "2.54",
										"4": "381"
									},
									{
										"0": "20161231",
										"1": "2169",
										"2": "316.800000000000000000",
										"3": "2.3913",
										"4": "55"
									},
									{
										"0": "20161231",
										"1": "2815",
										"2": "342.570000000000000000",
										"3": "2.85",
										"4": "57"
									},
									{
										"0": "20161231",
										"1": "4912",
										"2": "522.600000000000000000",
										"3": "2.3214",
										"4": "65"
									},
									{
										"0": "20161231",
										"1": "313",
										"2": "2638.220000000000000000",
										"3": "2.4821",
										"4": "278"
									},
									{
										"0": "20161231",
										"1": "3092",
										"2": "3017.600000000000000000",
										"3": "2.5949",
										"4": "410"
									},
									{
										"0": "20161231",
										"1": "950",
										"2": "2221.230000000000000000",
										"3": "2.5743",
										"4": "381"
									},
									{
										"0": "20161231",
										"1": "4947",
										"2": "718.080000000000000000",
										"3": "2.4286",
										"4": "51"
									},
									{
										"0": "20161231",
										"1": "146",
										"2": "5847.660000000000000000",
										"3": "2.4738",
										"4": "1274"
									},
									{
										"0": "20161231",
										"1": "106",
										"2": "14920.810000000000000000",
										"3": "2.4728",
										"4": "1543"
									},
									{
										"0": "20161231",
										"1": "5",
										"2": "10799.350000000000000000",
										"3": "2.5046",
										"4": "1355"
									},
									{
										"0": "20161231",
										"1": "170",
										"2": "7765.860000000000000000",
										"3": "2.4116",
										"4": "1119"
									},
									{
										"0": "20161231",
										"1": "120",
										"2": "13827.240000000000000000",
										"3": "2.5246",
										"4": "1593"
									},
									{
										"0": "20161231",
										"1": "91",
										"2": "11856.240000000000000000",
										"3": "2.5223",
										"4": "1188"
									},
									{
										"0": "20161231",
										"1": "217",
										"2": "16449.530000000000000000",
										"3": "2.5034",
										"4": "1457"
									},
									{
										"0": "20161231",
										"1": "4337",
										"2": "2874.720000000000000000",
										"3": "2.5489",
										"4": "339"
									},
									{
										"0": "20161231",
										"1": "3750",
										"2": "2188.800000000000000000",
										"3": "2.3226",
										"4": "288"
									},
									{
										"0": "20161231",
										"1": "3069",
										"2": "555.000000000000000000",
										"3": "2.5517",
										"4": "74"
									},
									{
										"0": "20161231",
										"1": "1981",
										"2": "433.840000000000000000",
										"3": "2.72",
										"4": "68"
									},
									{
										"0": "20161231",
										"1": "967",
										"2": "1513.800000000000000000",
										"3": "2.2308",
										"4": "261"
									},
									{
										"0": "20161231",
										"1": "2214",
										"2": "2822.250000000000000000",
										"3": "2.5357",
										"4": "355"
									},
									{
										"0": "20161231",
										"1": "4060",
										"2": "298.850000000000000000",
										"3": "2.5294",
										"4": "43"
									},
									{
										"0": "20161231",
										"1": "144",
										"2": "9263.050000000000000000",
										"3": "2.522",
										"4": "1145"
									},
									{
										"0": "20161231",
										"1": "224",
										"2": "15037.590000000000000000",
										"3": "2.4588",
										"4": "1163"
									},
									{
										"0": "20161231",
										"1": "221",
										"2": "8923.200000000000000000",
										"3": "2.5366",
										"4": "1144"
									},
									{
										"0": "20161231",
										"1": "206",
										"2": "10596.040000000000000000",
										"3": "2.4635",
										"4": "1148"
									},
									{
										"0": "20161231",
										"1": "3918",
										"2": "2415.080000000000000000",
										"3": "2.3741",
										"4": "349"
									},
									{
										"0": "20161231",
										"1": "2330",
										"2": "3508.380000000000000000",
										"3": "2.5029",
										"4": "438"
									},
									{
										"0": "20161231",
										"1": "3259",
										"2": "2484.300000000000000000",
										"3": "2.549",
										"4": "390"
									},
									{
										"0": "20161231",
										"1": "1533",
										"2": "2393.340000000000000000",
										"3": "2.5489",
										"4": "339"
									},
									{
										"0": "20161231",
										"1": "1842",
										"2": "528.660000000000000000",
										"3": "2.75",
										"4": "66"
									}
								],
								"schema": [
									{
										"key": "0",
										"name": "TransactionDate",
										"type": "int"
									},
									{
										"key": "1",
										"name": "ProductId",
										"type": "smallint"
									},
									{
										"key": "2",
										"name": "(sum)ProfitAmount",
										"type": "decimal"
									},
									{
										"key": "3",
										"name": "(avg)Quantity",
										"type": "double"
									},
									{
										"key": "4",
										"name": "(sum)Quantity",
										"type": "bigint"
									}
								]
							},
							"isSummary": false,
							"language": "scala"
						},
						"persist_state": {
							"view": {
								"type": "details",
								"chartOptions": {
									"chartType": "bar",
									"aggregationType": "sum",
									"categoryFieldKeys": [
										"1"
									],
									"seriesFieldKeys": [
										"0"
									],
									"isStacked": false
								}
							}
						}
					}
				}
			},
			"enableDebugMode": false,
			"kernelspec": {
				"name": "synapse_pyspark",
				"display_name": "Synapse PySpark"
			},
			"language_info": {
				"name": "python"
			},
			"a365ComputeOptions": {
				"id": "/subscriptions/3941d4c0-fdec-4aa0-9d9a-80436df48f39/resourceGroups/Synapse-WS-L400-459930/providers/Microsoft.Synapse/workspaces/asaworkspace459930/bigDataPools/SparkPool01",
				"name": "SparkPool01",
				"type": "Spark",
				"endpoint": "https://asaworkspace459930.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/SparkPool01",
				"auth": {
					"type": "AAD",
					"authResource": "https://dev.azuresynapse.net"
				},
				"sparkVersion": "2.4",
				"nodeCount": 3,
				"cores": 4,
				"memory": 28,
				"extraHeader": null
			}
		},
		"cells": [
			{
				"cell_type": "code",
				"metadata": {
					"microsoft": {
						"language": "python"
					},
					"collapsed": false
				},
				"source": [
					"%%pyspark\r\n",
					"df = spark.read.load('abfss://wwi-02@asadatalake459930.dfs.core.windows.net/sale-small/Year=2016/Quarter=Q4/Month=12/Day=20161231/sale-small-20161231-snappy.parquet', format='parquet')\r\n",
					"display(df.limit(10))"
				],
				"attachments": null,
				"execution_count": 1
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df.printSchema()"
				],
				"attachments": null,
				"execution_count": 2
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"from pyspark.sql import SparkSession\r\n",
					"from pyspark.sql.types import *\r\n",
					"from pyspark.sql.functions import *\r\n",
					"\r\n",
					"profitByDateProduct = (df.groupBy(\"TransactionDate\",\"ProductId\")\r\n",
					"    .agg(\r\n",
					"        sum(\"ProfitAmount\").alias(\"(sum)ProfitAmount\"),\r\n",
					"        round(avg(\"Quantity\"), 4).alias(\"(avg)Quantity\"),\r\n",
					"        sum(\"Quantity\").alias(\"(sum)Quantity\"))\r\n",
					"    .orderBy(\"TransactionDate\"))\r\n",
					"profitByDateProduct.show(100)"
				],
				"attachments": null,
				"execution_count": 3
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					},
					"collapsed": false
				},
				"source": [
					"display(profitByDateProduct.limit(100))"
				],
				"attachments": null,
				"execution_count": 4
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df = (spark.read \\\r\n",
					"        .option(\"inferSchema\", \"true\") \\\r\n",
					"        .json(\"abfss://wwi-02@asadatalake459930.dfs.core.windows.net/online-user-profiles-02/*.json\", multiLine=True)\r\n",
					"    )\r\n",
					"\r\n",
					"df.printSchema()"
				],
				"attachments": null,
				"execution_count": 5
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df.createOrReplaceTempView(\"user_profiles\")"
				],
				"attachments": null,
				"execution_count": 6
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					},
					"microsoft": {
						"language": "sparksql"
					},
					"collapsed": false
				},
				"source": [
					"%%sql\r\n",
					"\r\n",
					"SELECT * FROM user_profiles LIMIT 10"
				],
				"attachments": null,
				"execution_count": 7
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"flat=df.select('visitorId',explode('topProductPurchases').alias('topProductPurchases_flat'))\r\n",
					"flat.show(100)"
				],
				"attachments": null,
				"execution_count": 8
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"topPurchases = (flat.select('visitorId','topProductPurchases_flat.productId','topProductPurchases_flat.itemsPurchasedLast12Months')\r\n",
					"    .orderBy('visitorId'))\r\n",
					"\r\n",
					"topPurchases.show(100)"
				],
				"attachments": null,
				"execution_count": 11
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"sortedTopPurchases = topPurchases.orderBy(\"itemsPurchasedLast12Months\")\r\n",
					"\r\n",
					"sortedTopPurchases.show(100)"
				],
				"attachments": null,
				"execution_count": 12
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"sortedTopPurchases=topPurchases.orderBy(col(\"itemsPurchasedLast12Months\").desc())\r\n",
					"sortedTopPurchases.show(100)"
				],
				"attachments": null,
				"execution_count": 18
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"groupedTopPurchases = (sortedTopPurchases.select(\"visitorId\")\r\n",
					"    .groupBy(\"visitorId\")\r\n",
					"    .agg(count(\"*\").alias(\"total\"))\r\n",
					"    .orderBy(\"visitorId\") )\r\n",
					"\r\n",
					"groupedTopPurchases.show(100)"
				],
				"attachments": null,
				"execution_count": 19
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"groupedTopPurchases = (sortedTopPurchases.select(\"visitorId\",\"itemsPurchasedLast12Months\")\r\n",
					"    .groupBy(\"visitorId\")\r\n",
					"    .agg(sum(\"itemsPurchasedLast12Months\").alias(\"totalItemsPurchased\"))\r\n",
					"    .orderBy(\"visitorId\") )\r\n",
					"\r\n",
					"groupedTopPurchases.show(100)"
				],
				"attachments": null,
				"execution_count": 20
			}
		]
	}
}